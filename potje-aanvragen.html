<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lief & Leed Potje Aanvragen | Straatambassadeurs Vathorst & Hooglanderveen</title>
    <link rel="stylesheet" href="styles.css?v=20260719r2">
    <meta name="theme-color" content="#1a2744">
    <meta name="description" content="Vraag het Lief & Leed potje aan bij de straatambassadeurs Vathorst & Hooglanderveen. Buurtbudget van Gemeente Amersfoort voor lief en leed in de buurt.">
    <meta name="keywords" content="straatambassadeurs, Vathorst, Hooglanderveen, VathetVeen, Amersfoort, Amersfoort Noord, burendag, buren, buurt, wijkkrant, buurtbudget, lief en leed, kerngroep, buurtverbinding, buurtinitiatieven, wijkactiviteiten, bewonersinitiatieven, sociale cohesie, leefbaarheid, Oranjefonds, NLdoet, gemeente Amersfoort, Bovenduist, Waterdorp, De Laak, De Bron, indebuurt033">
    <meta property="og:title" content="Lief & Leed Potje Aanvragen - Straatambassadeurs">
    <meta property="og:description" content="Buurtbudget aanvragen voor lief en leed in Vathorst of Hooglanderveen. Gemeente Amersfoort buurtbudget via de straatambassadeurs.">
    <meta property="og:url" content="https://straatambassadeurs.nl/potje-aanvragen.html">
    <meta property="og:image" content="https://straatambassadeurs.nl/logo.jpg">
    <link rel="canonical" href="https://straatambassadeurs.nl/potje-aanvragen.html">
    <link rel="icon" href="favicon.png">
    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
</head>
<body>
        <header>
            <div class="header-content">
                <a href="index.html" class="logo" style="text-decoration:none;">
                    <picture><source media="(max-width: 600px)" srcset="images/logo-square.png"><img src="images/logo-header-new.png" alt="Straatambassadeurs" class="logo-img"></picture>
                    <div>
                        <div class="header-title">Vathorst &<br>Hooglanderveen</div>
                        <div class="header-subtitle">Samen maken we<br>de buurt mooier!</div>
                    </div>
                </a>
                <a href="handleiding.html" title="Handleiding" style="display:inline-flex;align-items:center;justify-content:center;width:24px;height:24px;border-radius:50%;background:rgba(255,255,255,0.12);color:white;text-decoration:none;font-size:12px;flex-shrink:0;">‚ùî</a>
                <button class="nav-toggle" onclick="document.querySelector('nav').classList.toggle('active')" aria-label="Menu"><span class="nav-toggle-label">MENU</span> ‚ò∞</button>
                <nav>
                    <a href="index.html">Home</a>
                    <a href="nieuws.html">Nieuws</a>
                    <a href="kaart.html">Kaart</a>
                    <div class="nav-dropdown">
                        <a href="over-sa.html" class="nav-dropdown-toggle">Ambassadeurs ‚ñæ</a>
                        <div class="nav-dropdown-menu">
                            <a href="over-sa.html">Informatie</a>
                            <a href="aanmelden.html">Aanmelden</a>
                            <a href="potje-aanvragen.html">Potje aanvragen</a>
                            <a href="potje-afrekenen.html">Potje afrekenen</a>
                            <hr style="margin:6px 8px;border:none;border-top:1px solid rgba(0,0,0,0.1);">
                            <a href="handleiding.html">üìñ Handleiding</a>
                        </div>
                    </div>
                    <a href="over-kerngroep.html">Kerngroep</a>
                    <a href="contact.html">Contact</a>
                    <a href="admin.html">Beheer</a>
                </nav>
                <button class="sidebar-toggle" onclick="openSidebar()" aria-label="Alle pagina's">‚ò∞</button>
                <div class="header-search">
                    <input type="text" id="site-search" placeholder="Zoeken..." autocomplete="off">
                    <div id="search-results" class="search-results"></div>
                </div>
            </div>
        </header>

        <div class="container">
        <main>
            <div class="form-card">
                <h2 class="form-title">üß° Lief & Leed Potje Aanvragen</h2>
                
                <div class="info-box" style="margin-bottom: 20px;">
                    <span class="info-box-icon">‚ÑπÔ∏è</span>
                    <div>
                        Na het indienen neemt iemand van de kerngroep mogelijk contact op voor verificatie van je gegevens.
                    </div>
                </div>
                
                <form id="potje-form">
                    <!-- 1. Jouw gegevens -->
                    <div class="form-section">
                        <h4>Jouw gegevens</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="naam">Je naam <span class="required">*</span></label>
                                <input type="text" id="naam" name="naam" placeholder="Je volledige naam">
                            </div>
                            <div class="form-group">
                                <label for="straat">Straat <span class="required">*</span></label>
                                <select id="straat" name="straat">
                                    <option value="">-- Kies je straat --</option>
                                    <option value="Ameliapolder">Ameliapolder</option>
                                    <option value="Archemerberg">Archemerberg</option>
                                    <option value="Beemster">Beemster</option>
                                    <option value="Boterberg">Boterberg</option>
                                    <option value="Braamberg">Braamberg</option>
                                    <option value="De Gavel">De Gavel</option>
                                    <option value="Dirk van Weelaan">Dirk van Weelaan</option>
                                    <option value="Durgerdamhaven">Durgerdamhaven</option>
                                    <option value="Eilandspolder">Eilandspolder</option>
                                    <option value="Emminkhuizerberg">Emminkhuizerberg</option>
                                    <option value="Eschberg">Eschberg</option>
                                    <option value="Geulemerberg">Geulemerberg</option>
                                    <option value="Heideweg">Heideweg</option>
                                    <option value="Hoekveen">Hoekveen</option>
                                    <option value="Hofstede">Hofstede</option>
                                    <option value="Johannes van Rossumlaan">Johannes van Rossumlaan</option>
                                    <option value="Kolhornkade">Kolhornkade</option>
                                    <option value="Laakboulevard">Laakboulevard</option>
                                    <option value="Laan van Bovenduist">Laan van Bovenduist</option>
                                    <option value="Laaxumstraat">Laaxumstraat</option>
                                    <option value="Landweg">Landweg</option>
                                    <option value="Lauwersmeer">Lauwersmeer</option>
                                    <option value="Lofoten">Lofoten</option>
                                    <option value="Paulinapolder">Paulinapolder</option>
                                    <option value="Purmer">Purmer</option>
                                    <option value="Riesenberg">Riesenberg</option>
                                    <option value="Straat van Dover">Straat van Dover</option>
                                    <option value="Suzannepolder">Suzannepolder</option>
                                    <option value="Tankenberg">Tankenberg</option>
                                    <option value="Vijlenerberg">Vijlenerberg</option>
                                    <option value="Weteringkade">Weteringkade</option>
                                    <option value="Zeisum">Zeisum</option>
                                    <option value="Zijpenberg">Zijpenberg</option>
                                    <option value="Zwarte Zee">Zwarte Zee</option>
                                    <option value="Anders">Anders (vul hieronder in)</option>
                                </select>
                            </div>
                        </div>
                        
                        <div id="andere-straat-veld" class="form-group hidden">
                            <label for="andere-straat">Andere straat</label>
                            <input type="text" id="andere-straat" name="andere-straat" placeholder="Vul je straatnaam in">
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="telefoon">Telefoonnummer <span class="required">*</span></label>
                                <input type="tel" id="telefoon" name="telefoon" placeholder="06-12345678">
                            </div>
                            <div class="form-group">
                                <label for="email">E-mailadres</label>
                                <input type="email" id="email" name="email" placeholder="jouw@email.nl">
                                <span class="field-hint">Voor bevestiging van je aanvraag</span>
                            </div>
                        </div>
                    </div>

                    <!-- 2. Eerder ontvangen -->
                    <div class="form-section">
                        <h4>Vorig potje</h4>
                        
                        <div class="form-group">
                            <label>Heb je al eerder een potje ontvangen? <span class="required">*</span></label>
                            <div class="radio-group">
                                <label class="radio-label">
                                    <input type="radio" name="eerder" value="nee" checked onchange="toggleEerderVelden()">
                                    <span>Nee, dit is mijn eerste</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="eerder" value="ja" onchange="toggleEerderVelden()">
                                    <span>Ja</span>
                                </label>
                            </div>
                        </div>
                        
                        <div id="eerder-velden" class="conditional-field hidden">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="eerder-maand">Maand</label>
                                    <select id="eerder-maand" name="eerder-maand">
                                        <option value="">Kies maand</option>
                                        <option value="1">Januari</option>
                                        <option value="2">Februari</option>
                                        <option value="3">Maart</option>
                                        <option value="4">April</option>
                                        <option value="5">Mei</option>
                                        <option value="6">Juni</option>
                                        <option value="7">Juli</option>
                                        <option value="8">Augustus</option>
                                        <option value="9">September</option>
                                        <option value="10">Oktober</option>
                                        <option value="11">November</option>
                                        <option value="12">December</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="eerder-jaar">Jaar</label>
                                    <select id="eerder-jaar" name="eerder-jaar">
                                        <option value="">Kies jaar</option>
                                        <option value="2026">2026</option>
                                        <option value="2025">2025</option>
                                        <option value="2024">2024</option>
                                        <option value="2023">2023</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="vorig-gebruik">Waarvoor heb je het vorige potje kunnen gebruiken?</label>
                                <textarea id="vorig-gebruik" name="vorig-gebruik" rows="2" placeholder="Bijv. bloemen voor zieke buur, welkomstcadeau nieuwe bewoners..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- 3. Administratie -->
                    <div class="form-section">
                        <h4>Administratie</h4>
                        
                        <div class="form-group">
                            <label>Hoe wil je de administratie (bonnetjes) regelen? <span class="required">*</span></label>
                            <div class="radio-group vertical">
                                <label class="radio-label">
                                    <input type="radio" name="administratie" value="zelf" onchange="toggleAfrekening()">
                                    <span>Ik bewaar zelf de administratie (min. 3 jaar)</span>
                                </label>
                                <label class="radio-label">
                                    <input type="radio" name="administratie" value="kerngroep" onchange="toggleAfrekening()">
                                    <span>Ik lever de administratie aan bij de kerngroep</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="form-section" id="afrekening-section" style="display: none;">
                        <h4>Afrekening vorig potje</h4>
                        <p style="font-size: 0.82rem; color: var(--gray-500); margin-bottom: 12px;">
                            Lever hieronder de administratie van je vorige potje aan bij de kerngroep.
                        </p>
                        
                        <div class="form-group">
                            <label>Overzicht uitgaven</label>
                            <div id="bonregels-container">
                                <div class="bonregel" style="display:grid; grid-template-columns: 50px 1fr 90px 32px; gap:6px; align-items:center; margin-bottom:4px;">
                                    <input type="text" class="bon-nr" placeholder="Nr." style="padding:8px; font-size:0.85rem; border:1px solid #93c5fd; border-radius:6px; text-align:center;">
                                    <input type="text" class="bon-omschrijving" placeholder="Omschrijving" style="padding:8px; font-size:0.85rem; border:1px solid #93c5fd; border-radius:6px;">
                                    <input type="text" class="bon-bedrag" placeholder="‚Ç¨ 0,00" style="padding:8px; font-size:0.85rem; border:1px solid #93c5fd; border-radius:6px; text-align:right;" oninput="berekenTotaal()">
                                    <span></span>
                                </div>
                            </div>
                            <div style="display:flex; justify-content:space-between; align-items:center; margin-top:8px;">
                                <button type="button" onclick="voegBonregelToe()" style="background:var(--street-blue); color:white; border:none; padding:6px 14px; border-radius:6px; font-size:0.8rem; cursor:pointer;">+ Regel toevoegen</button>
                                <div style="font-weight:700; font-size:0.9rem; color:var(--night-blue);">Totaal: ‚Ç¨ <span id="bon-totaal">0,00</span></div>
                            </div>
                            <span class="field-hint">Voeg per bon een regel toe met nummer, omschrijving en bedrag</span>
                        </div>
                        
                        <div class="form-group">
                            <label>Gescande bonnetjes uploaden</label>
                            <button type="button" onclick="document.getElementById('bonnetjes-upload').click()" style="background:var(--street-blue); color:white; border:none; padding:8px 16px; border-radius:6px; font-size:0.85rem; cursor:pointer;">üìé Bestanden toevoegen</button>
                            <input type="file" id="bonnetjes-upload" name="bonnetjes" multiple accept="image/*,.pdf" style="display:none;">
                            <span class="field-hint">Foto's of PDF's van bonnetjes (max. 10 MB per bestand). Je kunt meerdere keren bestanden toevoegen.</span>
                            <div id="bonnetjes-preview" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;"></div>
                        </div>
                    </div>

                    <!-- 4. Ervaring delen -->
                    <div class="form-section">
                        <h4>Jouw verhaal (optioneel)</h4>
                        
                        <div class="form-group">
                            <label for="ervaring">Wil je een mooie ervaring delen over jouw straat(ambassadeursschap)?</label>
                            <textarea id="ervaring" name="ervaring" rows="3" placeholder="Vertel iets leuks over je straat of een mooie ervaring als ambassadeur..."></textarea>
                            <span class="field-hint">Dit helpt ons bij het delen van succesverhalen</span>
                        </div>
                    </div>

                    <!-- 5. Doel nieuw potje -->
                    <div class="form-section">
                        <h4>Nieuwe aanvraag</h4>
                        
                        <div class="form-group">
                            <label for="doel">Omschrijf kort waarvoor je het potje wilt gebruiken <span class="required">*</span></label>
                            <textarea id="doel" name="doel" rows="3" placeholder="Bijv. bloemetje voor zieke buurvrouw, welkomstpakket nieuwe bewoners, koffie-ochtend organiseren..."></textarea>
                            <span class="field-hint">Bijv. bloemen, welkomstcadeau, straatborrel</span>
                        </div>
                    </div>

                    <!-- 6. Betaalgegevens -->
                    <div class="form-section">
                        <h4>Betaalgegevens</h4>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label for="iban">IBAN Rekeningnummer <span class="required">*</span></label>
                                <input type="text" id="iban" name="iban" placeholder="NL00 BANK 0000 0000 00" maxlength="22">
                            </div>
                            <div class="form-group">
                                <label for="tenaamstelling">Tenaamstelling <span class="required">*</span></label>
                                <input type="text" id="tenaamstelling" name="tenaamstelling" placeholder="Naam rekeninghouder">
                            </div>
                        </div>
                    </div>

                    <!-- 7. Verklaring -->
                    <div class="form-section">
                        <div class="checkbox-card">
                            <label>
                                <input type="checkbox" id="verklaring" name="verklaring">
                                <span>
                                    Ik verklaar het potje uitsluitend te besteden aan lief & leed activiteiten voor mijn straat 
                                    binnen de gestelde normen van de 
                                    <a href="https://www.amersfoort.nl/subsidie-lief-en-leed" target="_blank">subsidieregeling</a> 
                                    en ben zelf verantwoordelijk voor het administreren van de uitgaven.
                                </span>
                            </label>
                        </div>
                    </div>

                    <!-- Honeypot: verborgen veld tegen spam bots -->
                    <div class="hp-field" aria-hidden="true">
                        <label for="company">Bedrijf</label>
                        <input type="text" id="company" name="company" tabindex="-1" autocomplete="off">
                    </div>

                    <!-- Cloudflare Turnstile captcha -->
                    <!-- TODO: Vervang sitekey door echte key van Cloudflare dashboard -->
                    <div class="cf-turnstile" data-sitekey="0x4AAAAAACZV3vQxfcbSj8Va" data-theme="light"></div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-gold btn-full">
                            üß° Aanvraag indienen
                        </button>
                    </div>
                </form>
            </div>

            <div id="success-message" class="success-message hidden">
                <div class="success-icon">‚úÖ</div>
                <h3>Aanvraag ingediend!</h3>
                <p>
                    Dankjewel voor je inzet in de buurt! De kerngroep ontvangt je aanvraag 
                    en neemt deze in behandeling. Je ontvangt bericht wanneer het potje van ‚Ç¨100 is overgemaakt.
                </p>
                <p style="margin-top: 8px; font-size: 0.8rem; color: var(--gray-500);">
                    Van de straat, voor de straat üß°
                </p>
                <button onclick="resetForm()" class="btn btn-secondary">Nieuwe aanvraag</button>
            </div>
        </main>
        </div>

        <footer class="footer-pro">
            <div class="footer-tagline">Van de straat, voor de straat üß°</div>
            <div class="footer-domain">straatambassadeurs.nl</div>
            <div class="footer-links" style="margin-bottom:6px; font-size:0.72rem;"><a href="mailto:info@straatambassadeurs.nl" style="color:rgba(255,255,255,0.7); text-decoration:none;">‚úâÔ∏è info@straatambassadeurs.nl</a></div>
            <div class="footer-links" style="margin-bottom:4px;font-size:0.72rem;"><a href="handleiding.html" style="color:rgba(255,255,255,0.7);text-decoration:none;">‚ùì Hulp nodig? Bekijk de handleiding</a></div>
        <div class="footer-copy">¬© 2026 Straatambassadeurs Vathorst &amp; Hooglanderveen ¬∑ Een initiatief van bewoners</div>
        </footer>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
    <script src="supabase-config.js"></script>
    <script src="form-validation.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            window.supabaseClient = window.supabase.createClient('https://knxdefuncbzzbrunhlxg.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtueGRlZnVuY2J6emJydW5obHhnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzAwMjM0NzIsImV4cCI6MjA4NTU5OTQ3Mn0.QRQ0uxK65s_9EaVZkqpFMGOGCvpH5GKisHqg1ZZay3Y');
            
            const FV = FormValidation;
            const naamEl = document.getElementById('naam');
            const straatEl = document.getElementById('straat');
            const telefoonEl = document.getElementById('telefoon');
            const emailEl = document.getElementById('email');
            const doelEl = document.getElementById('doel');
            const ibanEl = document.getElementById('iban');
            const tenaamstellingEl = document.getElementById('tenaamstelling');
            const verklaringEl = document.getElementById('verklaring');
            const verklaringCard = document.querySelector('.checkbox-card');

            // Blur validation
            FV.attachBlurValidation(naamEl, () => FV.validateRequired(naamEl, 'Naam', 2));
            FV.attachBlurValidation(telefoonEl, () => FV.validatePhone(telefoonEl));
            FV.attachBlurValidation(emailEl, () => FV.validateEmailOptional(emailEl));
            FV.attachBlurValidation(doelEl, () => FV.validateRequired(doelEl, 'Doel', 2));
            FV.attachBlurValidation(ibanEl, () => FV.validateIBAN(ibanEl));
            FV.attachBlurValidation(tenaamstellingEl, () => FV.validateRequired(tenaamstellingEl, 'Tenaamstelling', 2));

            // IBAN auto-formatting
            ibanEl.addEventListener('input', () => {
                const pos = ibanEl.selectionStart;
                const oldLen = ibanEl.value.length;
                ibanEl.value = FV.formatIBAN(ibanEl.value);
                const newLen = ibanEl.value.length;
                // Adjust cursor position for added spaces
                ibanEl.setSelectionRange(pos + (newLen - oldLen), pos + (newLen - oldLen));
            });

            // Verklaring checkbox - clear error on change
            verklaringEl.addEventListener('change', () => {
                if (verklaringEl.checked) {
                    FV.clearCheckboxError(verklaringCard);
                }
            });

            // Straat dropdown validation on change
            straatEl.addEventListener('change', (e) => {
                if (e.target.value) FV.clearError(straatEl);
                const andereVeld = document.getElementById('andere-straat-veld');
                if (e.target.value === 'Anders') {
                    andereVeld.classList.remove('hidden');
                    document.getElementById('andere-straat').required = true;
                } else {
                    andereVeld.classList.add('hidden');
                    document.getElementById('andere-straat').required = false;
                }
            });

            // Form submit handler
            document.getElementById('potje-form').addEventListener('submit', handleSubmit);
        });
        
        function toggleEerderVelden() {
            const eerderJa = document.querySelector('input[name="eerder"][value="ja"]').checked;
            document.getElementById('eerder-velden').classList.toggle('hidden', !eerderJa);
        }
        
        async function handleSubmit(e) {
            e.preventDefault();

            // Honeypot check
            if (document.getElementById('company').value) return;

            // Turnstile token
            const turnstileToken = document.querySelector('[name="cf-turnstile-response"]')?.value;
            if (!turnstileToken) {
                alert('Wacht tot de beveiligingscheck is voltooid.');
                return;
            }
            
            const FV = FormValidation;
            const naamEl = document.getElementById('naam');
            const straatEl = document.getElementById('straat');
            const telefoonEl = document.getElementById('telefoon');
            const emailEl = document.getElementById('email');
            const doelEl = document.getElementById('doel');
            const ibanEl = document.getElementById('iban');
            const tenaamstellingEl = document.getElementById('tenaamstelling');
            const verklaringEl = document.getElementById('verklaring');
            const verklaringCard = document.querySelector('.checkbox-card');
            const adminRadio = document.querySelector('input[name="administratie"]:checked');

            // Run all validations
            let valid = true;
            if (!FV.validateRequired(naamEl, 'Naam', 2)) valid = false;
            
            // Straat select validation
            if (!straatEl.value) {
                FV.showError(straatEl, 'Kies je straat');
                valid = false;
            } else {
                FV.clearError(straatEl);
            }
            
            // If "Anders" selected, validate andere-straat field
            if (straatEl.value === 'Anders') {
                const andereStraat = document.getElementById('andere-straat');
                if (!FV.validateRequired(andereStraat, 'Straatnaam', 2)) valid = false;
            }

            if (!FV.validatePhone(telefoonEl)) valid = false;
            if (!FV.validateEmailOptional(emailEl)) valid = false;
            
            // Administratie radio required
            if (!adminRadio) {
                // Find the radio group and show error on the form-group container
                const adminGroup = document.querySelector('input[name="administratie"]').closest('.form-group');
                const errorEl = document.createElement('div');
                errorEl.className = 'error-msg';
                errorEl.textContent = 'Kies hoe je de administratie wilt regelen';
                // Only add if not already there
                if (!adminGroup.querySelector('.error-msg')) {
                    adminGroup.appendChild(errorEl);
                }
                valid = false;
            }
            
            if (!FV.validateRequired(doelEl, 'Doel', 2)) valid = false;
            if (!FV.validateIBAN(ibanEl)) valid = false;
            if (!FV.validateRequired(tenaamstellingEl, 'Tenaamstelling', 2)) valid = false;

            // Verklaring checkbox
            if (!verklaringEl.checked) {
                FV.showCheckboxError(verklaringCard, 'Je moet akkoord gaan met de verklaring om door te gaan');
                valid = false;
            } else {
                FV.clearCheckboxError(verklaringCard);
            }

            if (!valid) {
                const firstError = document.querySelector('.field-error, .checkbox-error, .error-msg');
                if (firstError) firstError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                return;
            }

            const eerderJa = document.querySelector('input[name="eerder"][value="ja"]').checked;
            
            // Get straat value (use "andere-straat" if "Anders" selected)
            let straatValue = straatEl.value;
            if (straatValue === 'Anders') {
                straatValue = document.getElementById('andere-straat').value;
            }
            
            const formData = {
                ambassadeur_naam: naamEl.value,
                straat: straatValue,
                telefoon: telefoonEl.value,
                email: emailEl.value || null,
                eerder_ontvangen: eerderJa,
                eerder_maand: eerderJa ? document.getElementById('eerder-maand').value : null,
                eerder_jaar: eerderJa ? document.getElementById('eerder-jaar').value : null,
                vorig_gebruik: document.getElementById('vorig-gebruik').value || null,
                administratie: adminRadio.value,
                afrekening_overzicht: JSON.stringify(getBonregelsData()) || null,
                afrekening_totaal: document.getElementById('bon-totaal')?.textContent || null,
                ervaring: document.getElementById('ervaring').value || null,
                doel: doelEl.value,
                iban: ibanEl.value.replace(/\s/g, ''),
                tenaamstelling: tenaamstellingEl.value,
                verklaring_akkoord: verklaringEl.checked,
                bedrag: 100,
                status: 'nieuw',
                created_at: new Date().toISOString()
            };
            
            const submitBtn = document.querySelector('#potje-form button[type="submit"]');
            if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Versturen...'; }
            
            try {
                if (window.supabaseClient) {
                    // Upload bonnetjes EERST naar Supabase Storage
                    const bonnetjesLinks = [];
                    const MAX_FILE_SIZE = 10 * 1024 * 1024;
                    
                    for (const file of verzameldeBonnetjes) {
                        if (file.size > MAX_FILE_SIZE) {
                            alert(`Bestand "${file.name}" is groter dan 10 MB. Kies een kleiner bestand.`);
                            if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = 'üß° Aanvraag indienen'; }
                            return;
                        }
                        const fileName = `bonnetjes/${Date.now()}_${file.name.replace(/[^a-zA-Z0-9._-]/g, '_')}`;
                        const { error: uploadError } = await window.supabaseClient.storage
                            .from('uploads')
                            .upload(fileName, file);
                        if (!uploadError) {
                            const { data: urlData } = window.supabaseClient.storage.from('uploads').getPublicUrl(fileName);
                            bonnetjesLinks.push({ name: file.name, url: urlData.publicUrl });
                        }
                    }

                    formData.bonnetjes_urls = bonnetjesLinks.length > 0 ? JSON.stringify(bonnetjesLinks) : null;

                    const { error } = await window.supabaseClient
                        .from('aanvragen')
                        .insert([formData]);
                    
                    if (error) throw error;

                    await fetch('/.netlify/functions/notify', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ type: 'potje', data: formData, turnstileToken })
                    }).catch(() => {});
                }
                
                document.getElementById('potje-form').classList.add('hidden');
                document.getElementById('success-message').classList.remove('hidden');
                
            } catch (error) {
                console.error('Error:', error);
                alert('Er ging iets mis. Probeer het opnieuw of neem contact op via WhatsApp.');
                if (submitBtn) { submitBtn.disabled = false; submitBtn.textContent = 'üß° Potje aanvragen'; }
            }
        }
        
        // Bonregels: toevoegen + verwijderen + totaal berekenen
        function voegBonregelToe() {
            const container = document.getElementById('bonregels-container');
            const count = container.querySelectorAll('.bonregel').length + 1;
            const row = document.createElement('div');
            row.className = 'bonregel';
            row.style.cssText = 'display:grid; grid-template-columns: 50px 1fr 90px 32px; gap:6px; align-items:center; margin-bottom:4px;';
            row.innerHTML = `
                <input type="text" class="bon-nr" value="${count}" style="padding:8px; font-size:0.85rem; border:1px solid #93c5fd; border-radius:6px; text-align:center;">
                <input type="text" class="bon-omschrijving" placeholder="Omschrijving" style="padding:8px; font-size:0.85rem; border:1px solid #93c5fd; border-radius:6px;">
                <input type="text" class="bon-bedrag" placeholder="‚Ç¨ 0,00" style="padding:8px; font-size:0.85rem; border:1px solid #93c5fd; border-radius:6px; text-align:right;" oninput="berekenTotaal()">
                <button type="button" onclick="verwijderBonregel(this)" style="background:none; border:none; color:#ef4444; font-size:1.1rem; cursor:pointer; padding:0;">‚úï</button>
            `;
            container.appendChild(row);
        }
        function verwijderBonregel(btn) {
            btn.closest('.bonregel').remove();
            berekenTotaal();
        }
        function berekenTotaal() {
            let totaal = 0;
            document.querySelectorAll('.bon-bedrag').forEach(el => {
                const val = el.value.replace(/[‚Ç¨\s]/g, '').replace(',', '.');
                const num = parseFloat(val);
                if (!isNaN(num)) totaal += num;
            });
            document.getElementById('bon-totaal').textContent = totaal.toFixed(2).replace('.', ',');
        }
        function getBonregelsData() {
            const regels = [];
            document.querySelectorAll('.bonregel').forEach(row => {
                const nr = row.querySelector('.bon-nr').value;
                const omschrijving = row.querySelector('.bon-omschrijving').value;
                const bedrag = row.querySelector('.bon-bedrag').value;
                if (omschrijving || bedrag) regels.push({ nr, omschrijving, bedrag });
            });
            return regels;
        }

        // Toggle afrekening sectie: alleen tonen als eerder=ja EN administratie=kerngroep
        function toggleAfrekening() {
            const eerderJa = document.querySelector('input[name="eerder"][value="ja"]')?.checked;
            const kerngroep = document.querySelector('input[name="administratie"][value="kerngroep"]')?.checked;
            const section = document.getElementById('afrekening-section');
            if (section) {
                section.style.display = (eerderJa && kerngroep) ? 'block' : 'none';
            }
        }
        // Hook eerder radio buttons too
        document.querySelectorAll('input[name="eerder"]').forEach(r => r.addEventListener('change', toggleAfrekening));

        // Bonnetjes accumulator ‚Äî bestanden worden verzameld, niet overschreven
        const verzameldeBonnetjes = [];
        
        document.getElementById('bonnetjes-upload').addEventListener('change', function() {
            const MAX = 10 * 1024 * 1024;
            [...this.files].forEach(file => {
                const isDuplicaat = verzameldeBonnetjes.some(f => f.name === file.name && f.size === file.size);
                if (!isDuplicaat) {
                    verzameldeBonnetjes.push(file);
                }
            });
            this.value = '';
            renderBonnetjesPreview();
        });

        function renderBonnetjesPreview() {
            const preview = document.getElementById('bonnetjes-preview');
            preview.innerHTML = '';
            const MAX = 10 * 1024 * 1024;
            verzameldeBonnetjes.forEach((file, index) => {
                const tooLarge = file.size > MAX;
                const tag = document.createElement('div');
                tag.style.cssText = `background:${tooLarge ? '#fef2f2' : '#e8f4fd'};border-radius:6px;padding:4px 10px;font-size:0.75rem;color:${tooLarge ? '#dc2626' : '#1a2744'};display:flex;align-items:center;gap:4px;`;
                const size = file.size > 1024*1024 ? (file.size/1024/1024).toFixed(1)+' MB' : (file.size/1024).toFixed(0)+' KB';
                tag.innerHTML = 'üìé ' + file.name + ' <span style="color:#888">(' + size + ')</span>' + (tooLarge ? ' ‚ö†Ô∏è te groot!' : '') +
                    ' <button type="button" onclick="verwijderBonnetje(' + index + ')" style="background:none;border:none;color:#ef4444;font-size:0.9rem;cursor:pointer;padding:0 2px;">‚úï</button>';
                preview.appendChild(tag);
            });
        }

        function verwijderBonnetje(index) {
            verzameldeBonnetjes.splice(index, 1);
            renderBonnetjesPreview();
        }

        function resetForm() {
            document.getElementById('potje-form').reset();
            document.getElementById('potje-form').classList.remove('hidden');
            document.getElementById('success-message').classList.add('hidden');
            document.getElementById('andere-straat-veld').classList.add('hidden');
            // Clear all validation states
            document.querySelectorAll('.field-error').forEach(el => el.classList.remove('field-error'));
            document.querySelectorAll('.error-msg').forEach(el => el.remove());
            document.querySelectorAll('.checkbox-error').forEach(el => el.classList.remove('checkbox-error'));
            verzameldeBonnetjes.length = 0;
            document.getElementById('bonnetjes-preview').innerHTML = '';
            toggleEerderVelden();
        }
    </script>
    <script src="search-index.js"></script>
    <script src="search.js"></script>

    <!-- Sidebar Menu -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    <div class="sidebar-menu" id="sidebarMenu">
        <div class="sidebar-header">
            <span>Menu</span>
            <button class="sidebar-close" onclick="closeSidebar()" aria-label="Sluiten">&times;</button>
        </div>
        <nav class="sidebar-nav">
            <a href="index.html">Home</a>
            <a href="nieuws.html">Nieuws</a>
            <a href="kaart.html">Kaart</a>
            <div class="sidebar-divider"></div>
            <a href="over-sa.html">Ambassadeurs</a>
            <a href="over-sa.html" class="sidebar-sub">Informatie</a>
            <a href="aanmelden.html" class="sidebar-sub">Aanmelden</a>
            <a href="potje-aanvragen.html" class="sidebar-sub">Potje aanvragen</a>
            <a href="potje-afrekenen.html" class="sidebar-sub">Potje afrekenen</a>
            <div class="sidebar-divider"></div>
            <a href="over-kerngroep.html">Kerngroep</a>
            <a href="contact.html">Contact</a>
            <a href="admin.html">Beheer</a>
        </nav>
    </div>
    <script>
    function openSidebar(){document.getElementById('sidebarMenu').classList.add('active');document.getElementById('sidebarOverlay').classList.add('active');document.body.style.overflow='hidden';}
    function closeSidebar(){document.getElementById('sidebarMenu').classList.remove('active');document.getElementById('sidebarOverlay').classList.remove('active');document.body.style.overflow='';}
    </script>
</body>
</html>
